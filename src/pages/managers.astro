---
import Layout from '../layouts/Layout.astro';
import Manager from '../components/Manager.astro';
import MobileMenu from '../components/MobileMenu.astro';
import { supabase } from '../lib/supabase';
const { data, error } = await supabase.rpc('get_managers_with_teams');
---


<Layout title="Liga NFL Tabernas Fantasy">
	<MobileMenu />
	
	<main style="margin-top: 80px;">
		<h1 style="margin-bottom: 0.5em;">
			<span class="text-gradient" style="font-size: 0.75em;">Tabernas Fantasy</span>
		</h1>

		<div>
			<img src="/nflFantasy.png" alt="NFL logo" style="width: 140px; height: 225px; border-radius: 10px; margin-left: auto; margin-right: auto; margin-bottom:1em"/>
		</div>

		<p class="instructions">
			Los mánagers
		</p>

		{/* Mensaje de error o sin datos */}
		{(error || !data || data.length === 0) && (
			<div class="error-message">
				<p>⚠️ No se pudieron cargar los datos</p>
				<p class="error-detail">
					{error 
						? 'Error de conexión con la base de datos. Por favor, intenta recargar la página.' 
						: 'No hay títulos registrados todavía.'}
				</p>
			</div>
		)}

		{data?.map(item => (
			<Manager team={item.team_name} manager={item.manager_name} description={item.manager_description} />
		))}
		
	</main>
</Layout>

<style>
	main {
		margin: auto;
		padding: 1rem;
		width: 800px;
		max-width: calc(100% - 2rem);
		color: white;
		font-size: 20px;
		line-height: 1.6;
	}
	.astro-a {
		position: absolute;
		top: -32px;
		left: 50%;
		transform: translatex(-50%);
		width: 220px;
		height: auto;
		z-index: -1;
	}
	h1 {
		font-size: 4rem;
		font-weight: 700;
		line-height: 1;
		text-align: center;
		margin-bottom: 1em;
	}
	.text-gradient {
		background-image: var(--accent-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 400%;
		background-position: 0%;
	}
	.instructions {
		margin-bottom: 2rem;
		border: 1px solid rgba(var(--accent-light), 25%);
		background: linear-gradient(rgba(var(--accent-dark), 66%), rgba(var(--accent-dark), 33%));
		padding: 1.5rem;
		border-radius: 8px;
	}
	.instructions code {
		font-size: 0.8em;
		font-weight: bold;
		background: rgba(var(--accent-light), 12%);
		color: rgb(var(--accent-light));
		border-radius: 4px;
		padding: 0.3em 0.4em;
	}
	.instructions strong {
		color: rgb(var(--accent-light));
	}
	.link-card-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(24ch, 1fr));
		gap: 2rem;
		padding: 0;
	}

	.instructions_champion {
	margin-bottom: 2rem;
	border: 1px solid rgba(50, 50, 50, 0.5);
	background: linear-gradient(rgba(30, 30, 30, 0.9), rgba(20, 20, 20, 0.8));
	padding: 1.5rem;
	border-radius: 8px;
}

/* Mensaje de error */
.error-message {
	background: linear-gradient(rgba(200, 0, 0, 0.4), rgba(150, 0, 0, 0.3));
	border: 2px solid rgba(255, 50, 50, 0.8);
	border-radius: 8px;
	padding: 2rem;
	text-align: center;
	margin: 2rem 0;
	box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
}

.error-message p {
	margin: 0.5rem 0;
	font-size: 1.2rem;
	color: #ff6b6b;
	font-weight: 600;
}

.error-message p:first-child {
	font-size: 1.5rem;
	color: #ff4444;
	font-weight: 700;
}

.error-detail {
	font-size: 1rem !important;
	color: rgba(255, 200, 200, 0.9) !important;
	font-weight: 400 !important;
}

</style>
